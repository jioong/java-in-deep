# 实现持久化

持久化的目的：将从数据库中查询的数据转换成所需的Java对象，或将Java对象中的数据存储到数据库中。

MyBatis通过抽象底层的JDBC代码，自动化SQL结果集产生Java对象、Java对象的数据持久化到数据库中的过程使得SQL变得更容易。

MyBatis提供一些特性来简化持久化逻辑的实现：

1. 它支持复杂的SQL结果集数据映射到嵌套对象图结构。
2. 它支持一对一和一对多的结果集和Java对象的映射。
3. 它支持根据输入的数据动态的构建SQL语句。

MyBatis 支持数据库连接池，消除了为每个请求创建一个数据库连接的开销。它同时提供了内存缓存机制，在SqlSession级别提供了对SQL查询结果的缓存。

使用完SqlSession后需要将其关闭，不然它不会被返回到连接池中，会导致连接被耗尽。

使用 insert 时需要关注 `commit`，不然数据可能没有提交到数据库中。

**工作原理**
1. MyBatis的主要配置文件中，包含了JDBC的连接参数和映射器的配置文件，映射器配置文件中包含了SQL语句的映射。
2. 使用配置文件创建SqlSessionFactory对象(该对象每个数据库环境就一个)
3. 映射器文件的namespace为对应接口文件的全限定名。
4. SqlSession对象不是线程安全的，并且不被共享。因此它的作用域最好为其所在方法的作用域。

MyBatis支持配置多个environment，可以支持在同一个应用中使用多个数据库。
数据源datasource:
    1. UNPOOLED, 为每个数据库操作创建一个连接，之后关闭它。适用于小规模数据并发并用的应用。
    2. POOLED,创建一个数据库连接池，连接池中的一个连接为数据库操作服务。服务完后放回连接池中。
    3. JNDI，从配置好的JNDI数据源获取数据库连接。生产环境中，优先考虑。
    
事务管理器transactionManager
    1. JDBC,被用作当应用程序负责管理数据连接的生命周期(提交，回退等)时。**需要应用程序自己管理事务**
    2. MANAGED，当由应用服务器负责管理数据库连接的声明周期的时候使用。也就是说，应用本身不用去管理事务相关的东西，而是把事务管理交给应用所在的服务器进行管理。
 
属性properties
    使用resource属性可以将配置值具体化到一个单独的属性文件中。同时，可以在properties下使用property配置默认参数的值，如果存在同名，它会被属性文件中的值覆盖。
    
类型别名typeAliases
    在Mapper配置文件中，对于resultType和parameterType属性值，需要使用类的全限定名。当配置别名后，则可以使用别名。
    可以不用单独为每个类指定别名，当使用package指定所在的包时，该包内所有的的JavaBean会被注册一个小写字母开头的非全限定名形式的别名。

类型处理器typeHandlers
    MyBatis对于以下类型使用内奸的类型处理器：所有的基本数据类型、基本类型的包裹类型、byte[],Date,Time,Timestamp,Java枚举类型等。
    注册对应的类型处理器后才能处理对象的类型。
    
全局参数设置settings
    MyBatis的默认全局参数可以被覆盖。
    
映射文件Mappers
    映射器配置文件中包含的SQL映射语句会被应用通过其statement id来使用。可以从不同类型的资源来加载映射器：
    1. resource 指定classpath中的mapper文件。
    2. url 则是通过文件系统路径或网络URL来指向mapper文件。
    3. class 用来指向一个mapper接口。
    4. package 用来指定可以找到Mapper接口的包名。