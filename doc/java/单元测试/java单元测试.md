# Java 单元测试

单元测试的目的是为了获得一个更好的整体质量，它是由程序员自己来完成的，并且最终受益者也是程序员自己。

## 什么是单元测试

**单元测试**是开发者编写的一小段代码，用于检验被测试代码的一个很小的、很明确的功能是否正确。
> 通常而言，一个单元测试是用于判断某个特定条件下某个特定函数的行为。

执行单元测试，是为了证明某段代码的行为确实和开发者所期望的一致。

## 测试代码必须要做的事

1. 准备测试所需的各种条件(创建所有必须的对象，分配必要的资源等)。
2. 调用要测试的方法。
3. 验证被测试的方法的行为和期望是否一致。
4. 完成后清理各种资源。

当有测试失败的时候，无论如何都不能给原有的代码再增加新的特性。此时应该尽快修复这个错误，直到所有的测试都能顺利通过。

## 测试哪些内容

应该关注``Right-BICEP`
* Right,结果是否正确？
* B，是否所有边界条件都是正确的？
* I，能查一下反向关联吗？
* C，能用其他手段交叉检查一下结果吗？
* E，是否可以强制错误条件发生？
* P，是否满足性能要求？

## 使用MOCK对象

单元测试的目标是每次只验证一个方法，，但是被测试的代码可能**依赖于系统的其他部分**。

Mock对象也就是真实对象在调试期的替代品。

* 真实对象具有不确定的行为。
* 真实对象很难被创建。
* 真实对象的某些行为很难触发(如网络错误)。
* 真实对象另程序的运行速度很慢。
* 真是对象有用户界面。
* 测试需要询问真实对象它是如何被调用的。
* 真实对象**可能**还并不存在。

借助Mock对象，可以解决上述问题。在使用Mock对象进行测试时，有3个步骤：
1. 使用一个接口来描述这个对象。
2. 为产品代码实现这个接口。
3. 以测试为目的，在mock对象中实现这个接口。

因为被测试代码只会通过接口来引用对象，所以它完全可以不知道它引用的究竟是真实对象还是mock对象。

> mock对象就是伪装出真实世界的某些部分，可以集中精力测试编写的代码。

## 好的测试所具有的品质

应具有如下品质：
* 自动化(Automatic)
* 彻底的(Thorough)
* 可重复(Repeatable)
* 独立的(Independent)
* 专业的(Professional)

单元测试需要能够被自动执行，包括：调用测试自动化和检查结果自动化。
每个测试都应该独立于所有其他的测试，而且还必须独立于周围的环境。目标就是，测试应该能够以任意的顺序一次又一次的运行，并且产生相同的结果。在必要的时候，应该使用
mock对象来隔离测试的外部因素，使测试能够独立于环境。
确保一次只测试一样东西。
测试代码是真实的代码。

## 设计话题

* 通过使用面向测试的设计方法，更好的分离关注点。
* 通过定义类不变性更好的阐明设计意图。
* 通过使用测试驱动的设计方法，改善接口的设计。
* 确立和局部化验证的责任。

**关注分离点**包括：封装性、正交性、耦合性和其他一切有助于编写"害羞代码"的概念。