# 重构原则

> 重构(名词)：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。

一般而言，重构都是对软件**小的改动**。

> 重构(动词)：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。

重构的目的是使软件更容易被理解和修改。
重构不会改变软件可观察的行为，重构之后软件功能一如既往。

### 两顶帽子

添加新的功能， 重构。
添加新功能的时候，不应该修改既有代码，只管添加新的功能。
重构时不能再添加新的功能，只管改进程序结构。此时，不应该添加任何测试(除非发现先前有遗漏的东西)，只在绝对必要(用以处理接口变化)时才修改测试。

## 为何重构

重构是个工具。

### 1. 重构改进软件设计

代码结构的流失是累积性的。越难看出代码所代表的设计意图，就越难保护其中的设计，于是该设计就腐败的越快。经常性的重构可以帮助维护代码该有的**形态**。

### 2. 重构使软件更容易理解

擦掉窗户上的污垢，使你看得更远。

### 3. 重构帮助找到bug

### 4. 重构提高编程速度

良好的设计是快速开发的根本，是维护软件开发速度的根本。

## 何时重构

重构应该随时随地进行。

### 1. 添加功能时重构

为了让添加新特性时更轻松。

### 2. 修补错误时重构

### 3. 复审代码时重构

-----------------------
1. 难以阅读的程序，难以修改。
2. 逻辑重复的程序，难以修改。
3. 添加新行为时需要修改已有代码的程序，难以修改。
4. 带复杂条件逻辑的程序，难以修改。

因此，我们希望：
1. 容易阅读。
2. 所有逻辑都只在唯一地点指定。
3. 新的改动不会危及现有行为。
4. 尽可能简单表达条件逻辑。
-----------------------

灵活的解决方案比简单的解决方案复杂许多，所以最终得到的软件通常会更难维护，虽然它在预先设想的方向上的确是更加灵活。因为变化可能出现在系统的各处，如果在所有可能出现
变化的地方都建立起灵活性，整个系统的复杂度和维护难度都会大大提高。而最后可能会发现这些灵活性都毫无必要，这才是最大的失败。