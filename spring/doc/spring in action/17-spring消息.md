# Spring消息

**异步消息**是一个应用程序向另一个应用程序间接发送消息的一种方式，这种方式无需等待对方的相应。

在Spring中可以使用*JMS, AMQP*发送和接受消息。除了基本的消息发送和接收之外，Spring还支持消息驱动`bean`。

## 1. 异步消息简介

同步方法，客户端必须等待远程方法完成后，才能继续执行。即使远程方法不向客户端返回任何消息，客户端也要被阻塞直到服务完成。
消息则是异步发送的，客户端不需要等待服务端处理消息，甚至不需要等待消息投递完成。客户端发送消息，然后继续执行，**因为客户端假定服务端最终可以收到并处理这条消息。**

### 1.1 发送消息

间接性是异步消息的关键所在。当一个应用向另一个应用发送消息时，两个应用之间没有直接的关联。

在异步消息中有两个主要概念：
* 消息代理（message broker）
* 目的地（destiation）

当一个应用发送消息的是哈，会将消息交给一个消息代理。消息代理实际上就类似于邮局。消息代理可以确保消息被投递到指定的目的地。同时，解放发送者，使其可以继续执行其他业务。

每条异步消息都会带有一个目的地。目的地好像一个邮箱，可以将消息放入这个邮箱，直到有人将它取走。

**点对点消息模型**

在该模型中，每一条消息都有一个发送者和一个接受者。可以保证消息只投递给一个接收者。
尽管消息队列中的每一条消息只能被投递给一个接收者，但并不意味着只能使用一个接收者从队列中获取消息。与银行排队等候类似。 
在该模型中，如果有多个接收者监听同一个队列，那么无法知道某条特定的消息会由哪一个接收者处理。

**发布-订阅消息模型**

在该模型中，消息会发送给一个主题。多个接收者可以监听一个主题，且所有监听者都会接收到消息的副本。
消息发发布者只知道它的消息要发送到一个特定的主题，而不知道谁在监听这个主题。也就是说，发布者不知道谁会处理消息。

### 1.2 异步消息的优点

同步通信比较容易理解，建立也较为简单。但是同步通信机制访问远程服务的客户端存在几个限制，如：
1. 同步消息意味着等待。如果客户端与服务端频繁通信，或者远程服务响应很慢，就会对客户端应用的性能带来负面影响。
2. 客户端同感服务接口与远程服务相耦合。如果服务的接口发生变化，此服务的所有客户端都需要作出相应的改变。
3. 客户端与远程服务的位置耦合。客户端必须配置服务的网络位置。
4. 客户端与服务的可用性相耦合。如果远程服务不可用，客户端实际上也无法正常运行。

异步消息的优点：
1. 无需等待。客户端只需要将消息发送给消息代理，就可以确信消息会被投递给相应的目的地。
2. 面向消息和解耦。异步消息是以数据为中心，意味着客户端并没有与特定的方法签名绑定。任何可以处理数据的队列或主题订阅者都可以处理由客户端发送的消息。
3. 位置独立。
4. 确保投递。

## 2. 使用JMS发送消息

Java消息服务JMS是一个Java标准，定义了使用消息代理的通用API。
Spring通过基于模板的抽象为JMS功能提供了支持，这个模板就是JmsTemplate。使用它能够非常容易的在消息生产方发送队列和主题消息，在消息消费方，也能够非常容易的接收这些消息。

Spring还提供了消息驱动POJO的理念：这是一个简单的java对象，它能够以异步的方式响应队列或主题上到达的消息。

### 2.1 在Sping中搭建消息代理

### 2.2 使用Spring的JMS模板

### 3.3 创建消息驱动的POJO

消息驱动bean就是将JMS中的消息作为事件，并对这些事件进行响应。

**创建消息监听器**

为POJO赋予消息 接收能力的诀窍是在Spring中把它配置为消息监听器。Spring的jms命名空间提供了所需的一切。
1. 首先，将该POJO声明为bean。
2. 然后，把bean转换为消息驱动的POJO。