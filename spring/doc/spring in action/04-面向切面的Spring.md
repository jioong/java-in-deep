# 面向切面的Spring

在软件开发中，散布于应用中多出的功能被称为**横切关注点(cross-cutting concern)**。通常来讲，这些横切关注点从概念上是与业务逻辑相互分离的，但是也
往往会直接嵌入业务逻辑之中。把这些横切关注点与业务逻辑相互分离正式面向切面编程(AOP)所要解决的问题。

> DI 有助于应用对象之间的解耦。AOP实现横切关注点与它们所影响的对象之间的解耦。

## 1. 什么是面向切面编程

横切关注点可以被描述为影响应用多处的功能。

> 使用面向切面编程时，任然在一个地方定义**通用功能**，但是可以通过**声明**的方式定义这个功能要**以何种方式在何处**应用，而无需修改受影响的类。

横切关注点可以被模块化为特殊的类，这些类被称为**切面 Aspect**。这样做有两个好处：
1. 每个关注点都集中在一个地方，而不是分散在多处代码中。
2. 服务模块更简洁。因为它们只包含要关注点的代码，而次要关注点的代码都被转移到切面中了。

### 1.1 定义AOP术语

1. 通知(Advice),切面的工作被称为通知。
    * 通知定义了切面是什么，以及何时使用。除了描述切面要完成的功能，通知还解决了何时执行这个工作的问题。
    * Spring 切面可以用于 5种类型的通知：
    * **前置通知(Before)**，在目标方法调用之前调用通知功能。
    * **后置通知(After)**，在目标方法完成之后调用通知，此时不会关注方法的输出是什么。
    * **返回通知(After-retturing)**，在目标方法**成功执行**之后调用通知。
    * **异常通知(After-throwing)**，在目标方法**抛出异常**后调用通知。
    * **环绕通知(Around)**，通知包裹了被通知的方法，在被通知的方法调用之前和调用之后执行自定义行为。
2. 连接点(Join Point)，连接点是在应用执行过程中能够掺入切面的一个点。
    * 这个点可以是调用方法时、抛出异常时、甚至是修改一个字段时。
    * 切面代码可以利用这些点插入到应用的正常流程在宏，并添加新的行为。
3. 切点(Pointcut)，一个切面不需要通知应用的所有连接点，切点有助于缩小切面所通知连接点的范围。
    * 切点定义了**何处**。
    * 切点的定义会匹配通知所要**织入**的一个或多个连接点。
    * 切点与连接点是一对多的关系。
4. 切面(Aspect)，切面是通知和切点的结合。
    * 通知和切点共同定义了切面的全部内容,**它是什么，在何时和何处完成其功能。**
5. 引入(Introduction)，引入允许我们向现有的类中添加新方法或属性。
    * 该特性可以在无需修改现有类的情况下，让它们具有新的行为和状态。
6. 织入(Weaving)，织入是把切面应用到目标对象中并创建新的代理对象的过程。
    * 切面在指定的连接点被织入到目标对象中。
    * 在目标对象的生命周期里有多个点可以进行织入：
    * **编译期**，切面在目标类编译时被织入。*AspectJ*的织入编译器就是以这种方式织入切面的。
    * **类加载期**，切面在目标类加载到JVM时被织入。这种方式需要特殊的类加载期，它可以在目标类被引用之前增强该目标类的字节码。
    * **运行期**，切面在应用运行的某个时刻被织入。一般情况下，在织入切面时，AOP容器回味目标对象动态地创建一个代理对象。`Spring AOP`以这种方式织入切面。
    
> 通知包含了需要用于多个应用对象的横切行为。连接点是程序执行过程中能够应用通知的所有点。切点定义了通知被应用的具体位置(在哪些连接点)。切面
定义了哪些连接点会得到通知。

### 1.2 Spring对AOP的支持

并不是所有的AOP框架都是相同的，它们在连接点模型上可能有强弱之分。

Spring提供了4种类型的AOP支持：
1. 基于dialing的经典`Spring AOP`.
2. 纯`POJO`切面。
3. `@AspectJ`注解驱动的切面。
4. 注入式`AspectJ`切面，适用于Spring各版本。
